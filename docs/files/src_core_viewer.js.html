<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/core/viewer.js - bimviews</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../../assets/images/logo.png" title="bimviews"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 2.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AmbientLight.html">AmbientLight</a></li>
                                <li><a href="../classes/Anaglyph.html">Anaglyph</a></li>
                                <li><a href="../classes/BIMSURFER.html">BIMSURFER</a></li>
                                <li><a href="../classes/BIMSURFER.constants.html">BIMSURFER.constants</a></li>
                                <li><a href="../classes/BIMSURFER.Viewer.html">BIMSURFER.Viewer</a></li>
                                <li><a href="../classes/BoxGeometry.html">BoxGeometry</a></li>
                                <li><a href="../classes/BoxObject.html">BoxObject</a></li>
                                <li><a href="../classes/Camera.html">Camera</a></li>
                                <li><a href="../classes/CameraControl.html">CameraControl</a></li>
                                <li><a href="../classes/CameraFlyAnimation.html">CameraFlyAnimation</a></li>
                                <li><a href="../classes/Canvas.html">Canvas</a></li>
                                <li><a href="../classes/ClickSelectObjects.html">ClickSelectObjects</a></li>
                                <li><a href="../classes/Component.html">Component</a></li>
                                <li><a href="../classes/Configs.html">Configs</a></li>
                                <li><a href="../classes/Debug.html">Debug</a></li>
                                <li><a href="../classes/DepthOfField.html">DepthOfField</a></li>
                                <li><a href="../classes/DirLight.html">DirLight</a></li>
                                <li><a href="../classes/Effect.html">Effect</a></li>
                                <li><a href="../classes/FrameEffect.html">FrameEffect</a></li>
                                <li><a href="../classes/Geometry.html">Geometry</a></li>
                                <li><a href="../classes/HighlightEffect.html">HighlightEffect</a></li>
                                <li><a href="../classes/Input.html">Input</a></li>
                                <li><a href="../classes/IsolateEffect.html">IsolateEffect</a></li>
                                <li><a href="../classes/KeyboardAxisCamera.html">KeyboardAxisCamera</a></li>
                                <li><a href="../classes/KeyboardOrbitCamera.html">KeyboardOrbitCamera</a></li>
                                <li><a href="../classes/KeyboardPanCamera.html">KeyboardPanCamera</a></li>
                                <li><a href="../classes/KeyboardZoomCamera.html">KeyboardZoomCamera</a></li>
                                <li><a href="../classes/Label.html">Label</a></li>
                                <li><a href="../classes/LabelEffect.html">LabelEffect</a></li>
                                <li><a href="../classes/Light.html">Light</a></li>
                                <li><a href="../classes/math.html">math</a></li>
                                <li><a href="../classes/MouseOrbitCamera.html">MouseOrbitCamera</a></li>
                                <li><a href="../classes/MousePanCamera.html">MousePanCamera</a></li>
                                <li><a href="../classes/MousePickObject.html">MousePickObject</a></li>
                                <li><a href="../classes/MouseZoomCamera.html">MouseZoomCamera</a></li>
                                <li><a href="../classes/Object.html">Object</a></li>
                                <li><a href="../classes/ObjectSet.html">ObjectSet</a></li>
                                <li><a href="../classes/PointLight.html">PointLight</a></li>
                                <li><a href="../classes/Position.html">Position</a></li>
                                <li><a href="../classes/RandomObjects.html">RandomObjects</a></li>
                                <li><a href="../classes/TeapotGeometry.html">TeapotGeometry</a></li>
                                <li><a href="../classes/TeapotObject.html">TeapotObject</a></li>
                                <li><a href="../classes/XRayEffect.html">XRayEffect</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/animate.html">animate</a></li>
                                <li><a href="../modules/BIMSURFER.html">BIMSURFER</a></li>
                                <li><a href="../modules/camera.html">camera</a></li>
                                <li><a href="../modules/control.html">control</a></li>
                                <li><a href="../modules/debug.html">debug</a></li>
                                <li><a href="../modules/effect.html">effect</a></li>
                                <li><a href="../modules/geometry.html">geometry</a></li>
                                <li><a href="../modules/input.html">input</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/core/viewer.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 A **Viewer** is a WebGL-based 3D viewer for the visualisation and evaluation of BIM models.

 ## Overview

 &lt;ul&gt;
 &lt;li&gt;&lt;/li&gt;
 &lt;/ul&gt;

 ## Example

 In the example below we&#x27;ll create a Viewer with a {{#crossLink &quot;Camera&quot;}}{{/crossLink}},
 a {{#crossLink &quot;CameraControl&quot;}}{{/crossLink}} and a {{#crossLink &quot;TeapotGeometry&quot;}}{{/crossLink}},
 which is used by an {{#crossLink &quot;Object&quot;}}{{/crossLink}}.
 &lt;br&gt;Finally, we make the {{#crossLink &quot;Camera&quot;}}{{/crossLink}} orbit on each &quot;tick&quot; event emitted by the Viewer.

 &lt;iframe style=&quot;width: 600px; height: 400px&quot; src=&quot;../../examples/viewer_Viewer.html&quot;&gt;&lt;/iframe&gt;

 &#x60;&#x60;&#x60;&#x60;javascript
 // Create a Viewer
 var viewer = new BIMSURFER.Viewer({

    // ID of the DIV element
    element: &quot;myDiv&quot;
 });

 // Create a Camera
 var camera = new BIMSURFER.Camera(viewer, {
        eye: [5, 5, -5]
    });

 // Create a CameraControl to control our Camera with mouse and keyboard
 var cameraControl = new BIMSURFER.CameraControl(viewer, {
        camera: camera
    });

 // Create a Geometry
 var geometry = new BIMSURFER.TeapotGeometry(viewer, {
        id: &quot;myGeometry&quot;
    });

 // Create an Object that uses the Geometry
 var object1 = new BIMSURFER.Object(viewer, {
        id: &quot;myObject1&quot;,
        type: &quot;IfcCovering&quot;,
        geometries: [ geometry ]
    });

 // Spin the camera
 viewer.on(&quot;tick&quot;, function () {
        camera.rotateEyeY(0.2);
    });
 &#x60;&#x60;&#x60;&#x60;

 @class Viewer
 @module BIMSURFER
 @constructor
 @param [cfg] {*} Configs
 @param [cfg.id] {String} Optional ID, unique among all components in the parent viewer, generated automatically when omitted.
 @param [cfg.meta] {String:Object} Optional map of user-defined metadata to attach to this Object.
 @param cfg.element {String|HTMLElement} ID or instance of a DIV element in the page.
 @param cfg.bimServerApi {*} The BIMServer API.
 */
(function () {

    &quot;use strict&quot;;

    BIMSURFER.Viewer = function (cfg) {

        var self = this;

        this.className = &quot;BIMSURFER.Viewer&quot;;

        // Event management

        // Pub/sub
        this._handleMap = new BIMSURFER.utils.Map(); // Subscription handle pool
        this._locSubs = {}; // A [handle -&gt; callback] map for each location name
        this._handleLocs = {}; // Maps handles to loc names
        this.props = {}; // Maps locations to publications


        // Check arguments

        cfg = cfg || {};

        var element = cfg.element;

        if (!element) {
            throw &quot;Param expected: element&quot;;
        }

        if (typeof element == &#x27;string&#x27;) {
            element = jQuery(&#x27;div#&#x27; + element)[0];
        }

        if (!jQuery(element).is(&#x27;div&#x27;)) {
            throw &quot;Can&#x27;t find div element&quot;;
        }

        // Clear container element

        jQuery(element).empty();

        /**
         * The HTML element ocupied by the Viewer
         *
         * @property element
         * @final
         * @type {HTMLElement}
         */
        this.element = element;


        /**
         * The BIMServer API
         *
         * @property bimServerApi
         * @final
         * @type {Object}
         */
        this.bimServerApi = cfg.bimServerApi;


        this.SYSTEM = this;


        /**
         * Servers connected to this Viewer.
         *
         * @property connectedServers
         * @type {Array of BIMSURFER.Server}
         */
        this.connectedServers = [];


        var canvasId = jQuery(this.element).attr(&#x27;id&#x27;) + &quot;-canvas&quot;;

        /**
         * The HTML Canvas that this Viewer renders to. This is inserted into the element we configured this Viewer with.
         * @property canvas
         * @final
         * @type {HTMLCanvasElement}
         * @final
         */
        this.canvas = jQuery(&#x27;&lt;canvas /&gt;&#x27;)
            .attr(&#x27;id&#x27;, canvasId)
            .attr(&#x27;width&#x27;, jQuery(this.element).width())
            .attr(&#x27;height&#x27;, jQuery(this.element).height())
            .html(&#x27;&lt;p&gt;This application requires a browser that supports the &lt;a href=&quot;http://www.w3.org/html/wg/html5/&quot;&gt;HTML5&lt;/a&gt; &amp;lt;canvas&amp;gt; feature.&lt;/p&gt;&#x27;)
            .addClass(this.className.replace(/\./g, &quot;-&quot;))
            .appendTo(this.element);


        /**
         * The SceneJS scene graph that renders 3D content for this Viewer.
         * @property scene
         * @final
         * @type {SceneJS.Scene}
         * @final
         */
        this.scene = SceneJS.createScene({

            canvasId: canvasId,

            // Transparent canvas
            // Less work for the GPU rendering all those background fragments.
            // Let CSS do that work.
            transparent: true,

            nodes: [

                // Node library, where we keep sharable
                // asset nodes, such as geometries
                {
                    type: &quot;library&quot;,
                    id: &quot;library&quot;
                },

                // Viewing transform
                {
                    type: &quot;lookAt&quot;,
                    id: &quot;theLookat&quot;,

                    nodes: [

                        // Projection transform
                        {
                            type: &quot;camera&quot;,
                            id: &quot;theCamera&quot;,

                            nodes: [

                                // Light sources
                                {
                                    id: &quot;lightsRoot&quot;,
                                    lights: [],

                                    nodes: [

                                        // Content is appended below this node
                                        {
                                            id: &quot;contentRoot&quot;
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        /**
         * ID of this Viewer
         *
         * @property id
         * @final
         * @type {String}
         */
        this.id = this.scene.getId();

        // Init events

        var canvas = this.scene.getCanvas();

        this.scene.on(&#x27;tick&#x27;,
            function (params) {
                self.fire(&#x27;tick&#x27;, {
                    time: params.time * 0.001,
                    elapsed: (params.time - params.prevTime) * 0.001
                });
            });

        this._lookatNode = this.scene.getNode(&#x27;theLookat&#x27;);

        this._lookatNode.on(&quot;matrix&quot;,
            function (matrix) {
                self.fire(&#x27;viewMatrix&#x27;, matrix);
            });

        this._cameraNode = this.scene.getNode(&#x27;theCamera&#x27;);

        this._cameraNode.on(&quot;matrix&quot;,
            function (matrix) {
                self.fire(&#x27;projMatrix&#x27;, matrix);
            });


        // Pool where we&#x27;ll keep all component IDs
        this._componentIDMap = new BIMSURFER.utils.Map();

        /**
         * The {{#crossLink &quot;Component&quot;}}Components{{/crossLink}} within this Viewer, mapped to their IDs.
         * @property components
         * @final
         * @type {{String:Component}}
         */
        this.components = {};


        /**
         * The {{#crossLink &quot;Component&quot;}}Components{{/crossLink}} within this Viewer, mapped to their class names.
         * @property classes
         * @final
         * @type {{String:{String:Component}}}
         */
        this.classes = {};


        /**
         * The {{#crossLink &quot;Component&quot;}}Components{{/crossLink}} within this Viewer, mapped to their IFC type names.
         * @property types
         * @final
         * @type {{String:{String:Component}}}
         */
        this.types = {};


        // Add components

        var components = cfg.components;

        if (components) {

            var component;
            var className;
            var constructor;

            for (var i = 0, len = components.length; i &lt; len; i++) {

                component = components[i];
                className = component.className;

                if (className) {
                    constructor = window[className];

                    if (constructor) {

                        // Adds component to this Viewer via #_addComponent
                        new constructor(this, component);
                    }
                }
            }
        }

        if (BIMSURFER.utils.isset(cfg, cfg.autoStart)) {
            if (!BIMSURFER.Util.isset(cfg.autoStart.serverUrl, cfg.autoStart.serverUsername, cfg.autoStart.serverPassword, cfg.autoStart.projectOid)) {
                console.error(&#x27;Some autostart parameters are missing&#x27;);
                return;
            }
            var _this = this;
            var BIMServer = new BIMSURFER.Server(this, cfg.autoStart.serverUrl, cfg.autoStart.serverUsername, cfg.autoStart.serverPassword, false, true, true, function () {
                if (BIMServer.loginStatus != &#x27;loggedin&#x27;) {
                    _this.element.innerHTML = &#x27;Something went wrong while connecting&#x27;;
                    console.error(&#x27;Something went wrong while connecting&#x27;);
                    return;
                }
                var project = BIMServer.getProjectByOid(cfg.autoStart.projectOid);
                project.loadScene((BIMSURFER.Util.isset(cfg.autoStart.revisionOid) ? cfg.autoStart.revisionOid : null), true);
            });
        }

        /**
         * Geometry loaders
         * @property geometryLoaders
         * @type {Array of }
         * @final
         */
        this.geometryLoaders = [];

        // Start the loading loop
        // This just runs forever, polling any loaders that exist on this viewer

        this.scene.on(&quot;tick&quot;,
            function () {
                self.geometryLoaders.forEach(
                    function (geometryLoader) {
                        geometryLoader.process();
                    });
            });

        /**
         * Input handling for this Viewer.
         * @property input
         * @final
         * @type {BIMSURFER.Input}
         */
        this.input = new BIMSURFER.Input(this);



        /**
         * The number of {{#crossLink &quot;Objects&quot;}}{{/crossLink}} within this ObjectSet.
         *
         * @property numObjects
         * @type Number
         */
        this.numObjects = 0;

        this._boundary = {xmin: 0.0, ymin: 0.0, zmin: 0.0, xmax: 0.0, ymax: 0.0, zmax: 0.0 };
        this._center = [0, 0, 0];

        this._boundaryDirty = true;
    };

    /**
     * Adds a {{#crossLink &quot;Component&quot;}}{{/crossLink}} to this viewer.
     *
     * This is called within the constructors of {{#crossLink &quot;Component&quot;}}{{/crossLink}} subclasses.
     *
     * The {{#crossLink &quot;Component&quot;}}{{/crossLink}} is assigned a
     * unique {{#crossLink &quot;Component/id:property&quot;}}{{/crossLink}} if it does not yet have one.
     *
     * @private
     * @param {BIMSURFER.Component} component The Component to add.
     */
    BIMSURFER.Viewer.prototype._addComponent = function (component) {

        var id = component.id;
        var className = component.className;

        // Check for ID clash

        if (id) {
            if (this.components[id]) {
                this.error(&quot;A component with this ID already exists in this Viewer: &quot; + id);
                return;
            }
        } else {
            id = component.id = this._componentIDMap.addItem({});
        }

        // Add component to ID map

        this.components[id] = component;

        // Add component to className map

        var classComponents = this.classes[className];
        if (!classComponents) {
            classComponents = this.classes[className] = {};
        }
        classComponents[id] = component;


        // Add component to type map

        if (component.type) {
            var type = component.type;
            var typeComponents = this.types[type];
            if (!typeComponents) {
                typeComponents = this.types[type] = {};
            }
            typeComponents[id] = component;
        }

        /**
         * Fired whenever a Component has been created within this Viewer.
         * @event componentCreated
         * @param {Component} value The component that was created
         */
        this.fire(&quot;componentCreated&quot;, component, true);
    };

    /**
     * Removes a {{#crossLink &quot;Component&quot;}}{{/crossLink}} from this Viewer.
     *
     * This is called within the destructors of {{#crossLink &quot;Component&quot;}}{{/crossLink}} subclasses.
     *
     * @private
     * @param {BIMSURFER.Component} component The component to remove
     */
    BIMSURFER.Viewer.prototype._removeComponent = function (component) {

        var id = component.id;
        var className = component.className;

        if (!this.components[id]) {
            console.warn(&quot;BIMSURFER.Viewer._removeComponent - Component with this ID is not within Viewer: &quot; + id);
            return;
        }

        delete this.components[id];
        delete this.classes[className][id];

        if (component.type) {
            delete this.types[component.type][id];
        }

        this._componentIDMap.removeItem(id);

        /**
         * Fired whenever a component within this Viewer has been destroyed.
         * @event componentDestroyed
         * @param {Component} value The component that was destroyed
         */
        this.fire(&quot;componentDestroyed&quot;, component, true);
    };

    /**
     * This Viewer&#x27;s view transformation matrix.
     *
     * @property viewMatrix
     * @final
     * @default [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]
     * @type {Array of Number}
     */
    Object.defineProperty(BIMSURFER.Viewer.prototype, &quot;viewMatrix&quot;, {

        get: function() {
            return this._lookatNode.getMatrix();
        },

        enumerable: true
    });


    /**
     * This Viewer&#x27;s projection transformation matrix.
     *
     * @property projMatrix
     * @final
     * @default [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]
     * @type {Array of Number}
     */
    Object.defineProperty(BIMSURFER.Viewer.prototype, &quot;projMatrix&quot;, {

        get: function() {
            return this._cameraNode.getMatrix();
        },

        enumerable: true
    });

    /**
     * Boundary of all components in this Viewer.
     *
     * @property boundary
     * @final
     * @type {*}
     */
    Object.defineProperty(BIMSURFER.Viewer.prototype, &quot;boundary&quot;, {

        get: function() {

            if (this._boundaryDirty) {
                this._rebuildBoundary();
            }

            return this._boundary;
        },

        enumerable: true
    });

    /**
     * center of all components in this Viewer.
     *
     * @property center
     * @final
     * @type {*}
     */
    Object.defineProperty(BIMSURFER.Viewer.prototype, &quot;center&quot;, {

        get: function() {

            if (this._boundaryDirty) {
                this._rebuildBoundary();
            }

            return this._center;
        },

        enumerable: true
    });

    BIMSURFER.Viewer.prototype._rebuildBoundary = function () {

//        if (!this._boundaryDirty) {
//            return;
//        }
//
//        // For an empty selection, boundary is zero volume and centered at the origin
//
//        if (this.numObjects === 0) {
//            this._boundary.xmin = -1.0;
//            this._boundary.ymin = -1.0;
//            this._boundary.zmin = -1.0;
//            this._boundary.xmax =  1.0;
//            this._boundary.ymax =  1.0;
//            this._boundary.zmax =  1.0;
//
//        } else {
//
//            // Set boundary inside-out, ready to expand by each selected object
//
//            this._boundary.xmin = 1000000.0;
//            this._boundary.ymin = 1000000.0;
//            this._boundary.zmin = 1000000.0;
//            this._boundary.xmax = -1000000.0;
//            this._boundary.ymax = -1000000.0;
//            this._boundary.zmax = -1000000.0;
//
//            var object;
//            var boundary;
//
//            for (var objectId in this.objects) {
//                if (this.objects.hasOwnProperty(objectId)) {
//
//                    object = this.objects[objectId];
//
//                    boundary = object.boundary;
//
//                    if (boundary.xmin &lt; this._boundary.xmin) {
//                        this._boundary.xmin = boundary.xmin;
//                    }
//                    if (boundary.ymin &lt; this._boundary.ymin) {
//                        this._boundary.ymin = boundary.ymin;
//                    }
//                    if (boundary.zmin &lt; this._boundary.zmin) {
//                        this._boundary.zmin = boundary.zmin;
//                    }
//                    if (boundary.xmax &gt; this._boundary.xmax) {
//                        this._boundary.xmax = boundary.xmax;
//                    }
//                    if (boundary.ymax &gt; this._boundary.ymax) {
//                        this._boundary.ymax = boundary.ymax;
//                    }
//                    if (boundary.zmax &gt; this._boundary.zmax) {
//                        this._boundary.zmax = boundary.zmax;
//                    }
//                }
//            }
//        }
//
//        this._center[0] = (this._boundary.xmax + this._boundary.xmin) * 0.5;
//        this._center[1] = (this._boundary.ymax + this._boundary.ymin) * 0.5;
//        this._center[2] = (this._boundary.zmax + this._boundary.zmin) * 0.5;
//
//        this._boundaryDirty = false;
    };

    /**
     *
     */
    BIMSURFER.Viewer.prototype.pick = function (x, y, options) {

        var hit = this.scene.pick(x, y, options);

        if (hit) {

            var objectId = hit.name;
            var object = this.components[objectId];

            if (object) {
                return {
                    object: object,
                    canvasPos: hit.canvasPos,
                    worldPos: hit.worldPos
                }
            }
        }
    };

    /**
     * Stores a connection to a server for later use.
     *
     * @param {BIMSURFER.Server} server The server connection to store.
     */
    BIMSURFER.Viewer.prototype.addConnectedServer = function (server) {
        if (this.connectedServers.indexOf(server) == -1) {
            this.connectedServers.push(server);
        }
    };

    /**
     * Resizes the viewport and updates the aspect ratio
     *
     * @param {Number} width The new width in px
     * @param {Number} height The new height in px
     */
    BIMSURFER.Viewer.prototype.resize = function (width, height) {

        if (!this.canvas) {
            // TODO: log
            return;
        }

        jQuery(this.canvas).width(width).height(height);

        if (BIMSURFER.Util.isset(this.canvas[0])) {
            this.canvas[0].width = width;
            this.canvas[0].height = height;
        }

        var cameraNode = this.scene.getNode(&quot;theCamera&quot;);
        var optics = cameraNode.getOptics();
        optics.aspect = jQuery(this.canvas).width() / jQuery(this.canvas).height();
        cameraNode.setOptics(optics);
    };

    /**
     * Loads and shows the geometry of the revisions that are in the load queue
     */
    BIMSURFER.Viewer.prototype.loadGeometry = function (geometryLoader) {

        var self = this;

        this.geometryLoaders.push(geometryLoader);

        // TODO limit to something useful

        if (this.geometryLoaders.length &lt;= 20) {
            geometryLoader.progressListeners.push(
                function (progress) {
                    if (progress == &quot;done&quot;) {
                        removeA(self.geometryLoaders, geometryLoader);
                    }
                });
            geometryLoader.start();
        }
    };

    /**
     * Iterates with a callback over Components of the given classes
     *
     * @param {String} classNames List of class names
     * @param {Function} callback Callback called for each Component of the given classes
     */
    BIMSURFER.Viewer.prototype.withClasses = function (classNames, callback) {
        var className;
        for (var i = 0, len = classNames.length; i &lt; len; i++) {
            className = classNames[i];
            var components = this.classes[className];
            if (components) {
                for (var id in components) {
                    if (components.hasOwnProperty(id)) {
                        callback(components[id]);
                    }
                }
            }
        }
    };

    /**
     * Iterates with a callback over Components of the given IFC types
     *
     * @param {String} typeNames List of type names
     * @param {Function} callback Callback called for each Component of the given types
     */
    BIMSURFER.Viewer.prototype.withTypes = function (typeNames, callback) {
        var typeName;
        for (var i = 0, len = typeNames.length; i &lt; len; i++) {
            typeName = typeNames[i];
            var components = this.types[typeName];
            if (components) {
                for (var id in components) {
                    if (components.hasOwnProperty(id)) {
                        callback(components[id]);
                    }
                }
            }
        }
    };

    /**
     * Shows an IFC type of a revision.
     *
     * @param {Array of String} typeNames Names of types to hide
     * @param {BIMSURFER.ProjectRevision instance} revision The revision
     */
    BIMSURFER.Viewer.prototype.showTypes = function (typeNames, revision) {
        this.withTypes(typeNames,
            function (component) {
                component.active = true;

            });
    };

    /**
     * Hides an IFC type of a revision.
     *
     * @param {Array of String} typeNames Names of types to hide
     * @param {BIMSURFER.ProjectRevision instance} revision The revision
     */
    BIMSURFER.Viewer.prototype.hideTypes = function (typeNames, revision) {
        this.withTypes(typeNames,
            function (component) {
                component.active = false;
            });
    };

    /**
     * Hides all the types of a revision
     *
     * @param {BIMSURFER.ProjectRevision} revision The revision to hide
     */
    BIMSURFER.Viewer.prototype.hideRevision = function (revision) {
//        var visibleTypes = revision.visibleTypes.slice(0);
//        for (var i = 0; i &lt; visibleTypes.length; i++) {
//            this.hideType(visibleTypes[i], revision);
//        }
    };

    /**
     * Shows a revision
     *
     * @param {BIMSURFER.ProjectRevision} revision The revision to show
     * @param {Array} [types] The types to show (default = BIMSURFER.constants.defaultTypes)
     */
    BIMSURFER.Viewer.prototype.showRevision = function (revision, types) {

        if (!types) {

            types = [];

            var defaultTypes = BIMSURFER.constants.defaultTypes;

            if (!defaultTypes) {
                this.warn(&quot;Property expected in BIMSURFER.constants: defaultTypes&quot;);

            } else {
                for (var i = 0; i &lt; revision.ifcTypes.length; i++) {
                    if (defaultTypes.indexOf(revision.ifcTypes[i]) != -1) {
                        types.push(revision.ifcTypes[i]);
                    }
                }
            }
        }

        this.showType(types, revision);
    };

    /**
     * Fires an event on this Viewer.
     *
     * Notifies existing subscribers to the event, retains the event to give to
     * any subsequent notifications on that location as they are made.
     *
     * @method fire
     * @param {String} event The event type name
     * @param {Object} value The event
     * @param {Boolean} [forget=false] When true, does not retain for subsequent subscribers
     */
    BIMSURFER.Viewer.prototype.fire = function (event, value, forget) {
        if (forget !== true) {
            this.props[event] = value; // Save notification
        }
        var subsForLoc = this._locSubs[event];
        var sub;
        if (subsForLoc) { // Notify subscriptions
            for (var handle in subsForLoc) {
                if (subsForLoc.hasOwnProperty(handle)) {
                    sub = subsForLoc[handle];
                    sub.callback.call(sub.scope, value);
                }
            }
        }
    };

    /**
     * Subscribes to an event on this Viewer.
     *
     * The callback is be called with this Viewer as scope.
     *
     * @method on
     * @param {String} event Publication event
     * @param {Function} callback Called when fresh data is available at the event
     * @param {Object} [scope=this] Scope for the callback
     * @return {String} Handle to the subscription, which may be used to unsubscribe with {@link #off}.
     */
    BIMSURFER.Viewer.prototype.on = function (event, callback, scope) {
        var subsForLoc = this._locSubs[event];
        if (!subsForLoc) {
            subsForLoc = {};
            this._locSubs[event] = subsForLoc;
        }
        var handle = this._handleMap.addItem(); // Create unique handle
        subsForLoc[handle] = {
            scope: scope || this,
            callback: callback
        };
        this._handleLocs[handle] = event;
        var value = this.props[event];
        if (value) { // A publication exists, notify callback immediately
            callback.call(scope || this, value);
        }
        return handle;
    };

    /**
     * Cancels an event subscription that was previously made with {{#crossLink &quot;Viewer/on:method&quot;}}{{/crossLink}} or
     * {{#crossLink &quot;Viewer/once:method&quot;}}{{/crossLink}}.
     *
     * @method off
     * @param {String} handle Publication handle
     */
    BIMSURFER.Viewer.prototype.off = function (handle) {
        var event = this._handleLocs[handle];
        if (event) {
            delete this._handleLocs[handle];
            var locSubs = this._locSubs[event];
            if (locSubs) {
                delete locSubs[handle];
            }
            this._handleMap.removeItem(handle); // Release handle
        }
    };

    /**
     * Subscribes to the next occurrence of the given event on this Viewer, then un-subscribes as soon as the event is handled.
     *
     * @method once
     * @param {String} event Data event to listen to
     * @param {Function(data)} callback Called when fresh data is available at the event
     * @param {Object} [scope=this] Scope for the callback
     */
    BIMSURFER.Viewer.prototype.once = function (event, callback, scope) {
        var self = this;
        var handle = this.on(event,
            function (value) {
                self.off(handle);
                callback(value);
            },
            scope);
    };

    /**
     * Logs a console debugging message for this View.
     *
     * The console message will have this format: *&#x60;&#x60;&#x60;&#x60;[LOG] BIMSERVER.Viewer: &lt;message&gt;&#x60;&#x60;&#x60;&#x60;*
     *
     * @method log
     * @param {String} message The message to log
     */
    BIMSURFER.Viewer.prototype.log = function (message) {
        window.console.log(&quot;[LOG] BIMSERVER.Viewer: &quot; + message);
    };

    /**
     * Logs an error for this View to the JavaScript console.
     *
     * The console message will have this format: *&#x60;&#x60;&#x60;&#x60;[ERROR] BIMSERVER.Viewer: &lt;message&gt;&#x60;&#x60;&#x60;&#x60;*
     *
     * @method error
     * @param {String} message The message to log
     */
    BIMSURFER.Viewer.prototype.error = function (message) {
        window.console.error(&quot;[ERROR] BIMSERVER.Viewer: &quot; + message);
    };

})();
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
